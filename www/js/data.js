/**
 * Created with JetBrains WebStorm.
 * User: Ian
 * Date: 27/08/12
 * Time: 10:46 AM
 * To change this template use File | Settings | File Templates.
 */
var data = {
  EYLF: {

    OutcomeOne: "Outcome One: Children have a strong sense of identity.",
    OutcomeTwo: "Outcome Two: Children are connected with and contribute to their world.",
    OutcomeThree: "Outcome Three: Children have a strong sense of well being.",
    OutcomeFour: "Outcome Four: Children are confident and involved learners.",
    OutcomeFive: "Outcome Five: Children are effective communicators.",

    OutcomeOneA: ["Children feel safe, secure and supported.","Builds secure attachments with one and then more familiar educators", "Uses effective routines to help make predicted transitions smoothly", "Senses and responds to a feeling of belonging, communicates their needs for comfort and assistance", "Establishes and maintains respectful, trusting relationships with other children and educators", "Openly expresses their feelings and ideas in their interactions with others", "Responds to ideas and suggestions from others", "Initiates interactions and conversations with trusted educators", "Confidently explores and engages with social and physical environments through relationships and play", "Initiates and joins in play", "Explores aspects of identity through role play"],
    OutcomeOneB: ["Children develop their emerging autonomy,inter-dependence, resilience and sense of agency.","Demonstrates increasing awareness of the needs and rights of others","Is open to new challenges and discoveries","Increasingly co-operates and works collaboratively with others", "Takes considered risk in their decision-making and copes with the unexpected","Recognises their individual achievements and the achievements of others", "Demonstrates an increasing capacity for self-regulation","Approaches new safe situations with confidence", "Begins to initiate negotiating and sharing  behaviours", "Persists when faced with challenges and when first attempts are not successful"],
    OutcomeOneC: ["Children develop knowledgeable and confident self identities.","Feels recognised and respected for who they are", "Explores different identities and points of view in dramatic play", "Shares aspects of their culture with the other children and educators", "Uses their home language to construct meaning", "Develops strong foundations in both the culture and language/s of their family and of the broader community without compromising their cultural identities", "Develops their social and cultural heritage through engagement with Elders and community members", "Reaches out and communicates for comfort, assistance and companionship", "Celebrates and shares their contributions and achievements with others"],
    OutcomeOneD: ["Children learn to interact in relation to others with care, empathy and respect.","Shows interest in other children and being part of a group ", "Engages in and contributes to shared play experiences","Expresses a wide range of emotions, thoughts and views constructively ", "Empathises with and expresses concern for others ", "Displays awareness of and respect for others’ perspectives", "Reflects on their actions and considers consequences for others"],

    OutcomeTwoA: ["Children develop a sense of belonging to groups and communities and an understanding of the reciprocal rights and responsibilities necessary for active community participation.","Begins to recognise that they have a right to belong to many communities", "Cooperates with others and negotiates roles and relationships in play episodes and group experiences", "Takes action to assist other children to participate in social groups", "Broadens their understanding of the world in which they live", "Expresses an opinion in matters that affect them", "Builds on their own social experiences to explore other ways of being", "Participates in reciprocal relationships", "Gradually learns to ‘read’ the behaviours of others and respond appropriately", "Understands different ways of contributing through play and projects", "Demonstrates a sense of belonging and comfort in their environments", "Is playful and responds positively to others, reaching out for company and friendship", "Contributes to fair decision-making about matters that affect them"],
    OutcomeTwoB: ["Children respond to diversity with respect.","Begins to show concern for others", "Explores the diversity of culture, heritage, background and tradition and that diversity presents opportunities for choices and new understandings","Becomes aware of connections, similarities and differences between people","Listens to others’ ideas and respects different ways of being and doings", "Practices inclusive ways of achieving coexistence", "Notices and reacts in positive ways to similarities and differences among people" ],
    OutcomeTwoC: ["Children become aware of fairness.","Discovers and explores some connections amongst people","Becomes aware of ways in which people are included or excluded from physical and social environments","Develops the ability to recognise unfairness and bias and the capacity to act with compassion and kindness","Is empowered to make choices and problem solve to meet their needs in particular contexts", "Begins to think critically about fair and unfair behaviour","Begins to understand and evaluate ways in which texts construct identities and create stereotypes"],
    OutcomeTwoD: ["Children become socially responsible and show respect for the environment.","Uses play to investigate, project and explore new ideas","Participates with others to solve problems and contribute to group outcomes","Demonstrates an increasing knowledge of, and respect for natural and constructed environments","Explores, infers, predicts and hypothesises in order to develop an increased understanding of the interdependence between land, people, plants and animals","Shows growing appreciation and care for natural and constructed environments","Explores relationships with other living and non-living things and observes, notices and responds to change","Develops an awareness of the impact of human activity on environments and the interdependence of living things"],

    OutcomeThreeA: ["Children become strong in their social and emotional wellbeing.","Demonstrates trust and confidence","Remains accessible to others at times of distress, confusion and frustration","Shares humour, happiness and satisfaction, seeks out and accepts new challenges, makes new discoveries, and celebrates their own efforts and achievements and those of others","Increasingly co-operates and works collaboratively with others","Enjoys moments of solitude","Recognises their individual achievement", "Makes choices, accept challenges, take considered risks, manages change and copes with frustrations and the unexpected", "Shows an increasing capacity to understand, self-regulate and manage their emotions in ways that reflect the feelings and needs of others", "Experiences and shares personal successes in learning and initiates opportunities for new learning in their home languages or Standard Australian English", "Acknowledges and accepts affirmation", "Asserts their capabilities and independence while demonstrating increasing awareness of the needs and rights of others","Recognises the contributions they make to shared projects and experiences "],
    OutcomeThreeB: ["Children take increasing responsibility for their own health and physical wellbeing.","Recognises and communicates their bodily needs (for example, thirst, hunger, rest, comfort, physical activity)","Is happy, healthy, safe and connected to others", "Engages in increasingly complex sensory- motor skills and movement patterns", "Combines gross and fine motor movement and balance to achieve increasingly complex patterns of activity including dance, creative movement and drama", "Uses their sensory capabilities and dispositions with increasing integration, skill and purpose to explore and respond to their world", "Demonstrates spatial awareness and orientate themselves, moving around and through their environments confidently and safely", "Manipulates equipment and manages tools with increasing competence and skill", "Responds through movement to traditional and contemporary music, dance and storytelling", "Shows an increasing awareness of healthy lifestyles and good nutrition", "Shows increasing independence and competence in personal hygiene, care and safety for themselves and others", "Shows enthusiasm for participating in physical play and negotiates play spaces to ensure the safety and wellbeing of themselves and others"],

    OutcomeFourA: ["Children develop dispositions for learning such as curiosity, cooperation, confidence, creativity, commitment, enthusiasm, persistence, imagination and reflexivity.","Expresses wonder and interest in their environment","Is a curious and enthusiastic participant in their learning","Uses play to investigate, imagine and explore ideas", "Follows and extends their own interests with enthusiasm, energy and concentration", "Initiates and contributes to play experiences emerging from their own ideas", "Participates in a variety of rich and meaningful inquiry-based experiences","Perseveres and experiences the satisfaction of achievement", "Persists even when they find a task difficult "],
    OutcomeFourB: ["Children develop a range of skills and processes such as problem solving, enquiry, experimentation, hypothesising, researching and investigating.","Applies a wide variety of thinking strategies to engage with situations and solve problems, and adapts these strategies to new situations","Creates and uses representation to organise, record and communicate mathematical ideas and concepts","Makes predictions and generalisations about their daily activities, aspects of the natural world and environments, using patterns they generate or identify and communicate these using mathematical language and symbols","Explores their environment","Manipulates objects and experiment with cause and effect, trial and error, and motion","Contributes constructively to mathematical discussions and arguments","Uses reflective thinking to consider why things happen and what can be learnt from these experiences"],
    OutcomeFourC: ["Children transfer and adapt what they have learned from one context to another.","Engages with and co-construct learning","Develops an ability to mirror, repeat and practice the actions of others, either immediately or later","Makes connections between experiences, concepts and processes","Uses the processes of play, reflection and investigation to solve problems","Applies generalisations from one situation to another","Tries out strategies that were effective to solve problems in one situation in a new context","Transfers knowledge from one setting to another"],
    OutcomeFourD: ["Children resource their own learning through connecting with people, place, technologies and natural and processed materials.","Engages in learning relationships ","Uses their senses to explore natural and built environments","Experiences the benefits and pleasures of shared learning exploration","Explores the purpose and function of a range of tools, media, sounds and graphics","Manipulates resources to investigate, take apart, assemble, invent and construct", "Experiments with different technologies, uses information and communication technologies (ICT) to  investigate and problem solve","Explores ideas and theories using imagination, creativity and play", "Uses feedback from themselves and others to revise and build on an idea"],

    OutcomeFiveA: ["Children interact verbally and non-verbally with others for a range of purposes.","Engages in enjoyable interactions using verbal and non-verbal language",        "Conveys and constructs messages with purpose and confidence, building on home/family and community literacies",        "Responds verbally and non-verbally to what they see, hear, touch, feel and taste",        "Uses language and representations from play, music and art to share and project meaning",        "Contributes their ideas and experiences in play, small and large group discussions",        "Attends and gives cultural cues that they are listening to and understanding what is said to them",        "Is an independent communicator who initiates Standard Australian English and home language conversations and demonstrates the ability to meet the listeners’ needs",        "Interacts with others to explore ideas and concepts, clarify and challenge thinking, negotiate and share new understandings",        "Conveys and constructs messages with purpose and confidence, building on literacies of home/family and the broader community",        "Exchanges ideas, feelings and understandings using language and representations in play",        "Demonstrates an increasing understanding of measurement and number using vocabulary to describe size, length, volume, capacity and names of numbers",        "Expresses ideas and feelings and understands and respects the perspectives of others",        "Uses language to communicate thinking about quantities to describe attributes of objects and collections, and to explain mathematical ideas","Shows increasing knowledge, understanding and skill in conveying meaning in at least one language"],
    OutcomeFiveB: ["Children engage with a range of texts and gain meaning from these texts.","Listens and responds to sounds and patterns in speech, stories and rhymes in context",        "Views and listens to printed, visual and multimedia texts and responds with relevant gestures, actions, comments and/or questions",        "Sings and chants rhymes, jingles and songs",        "Takes on roles of literacy and numeracy users in their play",        "Begins to understand key literacy and numeracy concepts and processes, such as the sounds of language, letter-sound relationships, concepts of print and the ways that texts are structured",        "Explores texts from a range of different perspectives and begins to analyse the meanings",        "Actively uses, engages with and shares the enjoyment of language and texts in a range of ways",        "Recognises and engages with written and oral culturally constructed texts"],
    OutcomeFiveC: ["Children express ideas and make meaning using a range of media.","Uses language and engages in play to imagine and create roles, scripts and ideas",        "Shares the stories and symbols of their own culture and re-enacts well-known stories",        "Uses the creative arts such as drawing, painting, sculpture, drama, dance, movement, music and storytelling to express ideas and make meaning",        "Experiments with ways of expressing ideas and meaning using a range of media",        "Begins to use images and approximations of letters and words to convey meaning "],
    OutcomeFiveD: ["Children begin to understand how symbols and pattern systems work.","Uses symbols in play to represent and make meaning",        "Begins to make connections between and see patterns in their feelings, ideas, words and actions and those of others",        "Notices and predicts the patterns of regular routines and the passing of time",        "Develops an understanding that symbols are a powerful means of communication and that ideas, thoughts and concepts can be represented through them",        "Begins to be aware of the relationships between oral, written and visual representations",        "Begins to recognise patterns and relationships and the connections between them",        "Begins to sort, categorise, order and compare collections and events and attributes of objects and materials, in their social and natural worlds",        "Listens and responds to sounds and patterns in speech, stories and rhyme",        "Draws on memory of a sequence to complete a task",        "Draws on their experiences in constructing meaning using symbols "],
    OutcomeFiveE: ["Children use information and communication technologies to access information, investigate ideas and represent their thinking.","Identifies the use of technologies in everyday life and uses real or imaginary technologies as props in their play",        "Uses information and communication technologies to access images and information, explore diverse perspectives and make sense of their world",        "Uses information and communication technologies as tools for designing, drawing, editing, reflecting and composing",      "Engages with technology for fun and to make meaning"]
  },

    QKLG: {
        OutcomeOne: "Identity - A kindergarten child who has a strong sense of identity.",
        OutcomeTwo: "Connectedness - A kindergarten child who is connected with and contributes to their world.",
        OutcomeThree: "Wellbeing - A kindergarten child who has a strong sense of wellbeing.",
        OutcomeFour: "Active Learning - A kindergarten child who is a confident and involved learner.",
        OutcomeFive: "Communicating - A kindergarten child who is an effective communicator.",

        OutcomeOneA: ["Is building a sense of security and trust","a sense of being safe, accepted and supported","a sense of belonging and confidence in others"],
        OutcomeOneB: ["Acts with increasing independence and perseverance","organising self and belongings and managing routines","making choices","willingness to keep trying"],
        OutcomeOneC: ["Is building a confident self-identity","pride and confidence in who they are, their family and culture","pride and confidence in their strengths and abilities","confidence in themselves as a learner"],

        OutcomeTwoA: ["Is building positive relationships with others","skills for connecting with and relating to others","awareness of own and others’ rights and responsibilities","understandings about fairness"],
        OutcomeTwoB: ["Shows increasing respect for diversity","ways to respond to others with respect","interest in their own culture and others’ cultures and heritages","exploring aspects of culture and similarities and differences among people","awareness of bias and stereotyping"],
        OutcomeTwoC: ["Shows increasing respect for environments","caring for and respecting environments","ways to investigate and understand natural and built environments","exploring interactions between people and environments"],

        OutcomeThreeA: ["Is building a sense of autonomy and wellbeing","delight in making decisions and choices (agency)","courage and resilience to manage change and challenges","ways to understand and regulate emotions"],
        OutcomeThreeB: ["Explores ways to show care and concern and interact positively with others","interest in and desire to interact with others","considering and empathising with others"],
        OutcomeThreeC: ["Explores ways to promote own and others’ health and safety","ways to manage personal hygiene and self-care","ways to stay healthy and safe"],
        OutcomeThreeD: ["Explores ways to promote physical wellbeing","control and strength for manipulating objects, tools and equipment","large movement skills, movement control, coordination and strength","confidence to engage in movement challenges"],

        OutcomeFourA: ["Is building positive dispositions and approaches toward learning","enthusiasm for learning and curiosity","problem solving and investigating","applying and reflecting on learning"],
        OutcomeFourB: ["Shows increasing confidence and involvement in learning","confidence, interest and involvement in learning","making choices and organising resources for learning","ways to contribute to learning conversations"],
        OutcomeFourC: ["Engages in ways to be imaginative and creative","a sense of wonder, imagination and creativity","ways to creatively represent ideas, feelings and experiences"],
        OutcomeFourD: ["Explores tools, technologies and information and communication technologies (ICTs)","using tools and technologies in play and active learning","using information and communication technologies for a range of purposes"],

        OutcomeFiveA:["Explores and expands ways to use language","spoken and nonverbal communication","age-appropriate speech patterns, vocabulary and sentence structures","using language for a range of purposes","skills for listening and taking turns in conversations"],
        OutcomeFiveB:["Explores and engages with literacy in personally meaningful ways","positive engagement with a variety of print and multimedia texts and the arts","exploring symbols and patterns in language","exploring text purposes and meanings","confidence and interest in exploring reading and writing behaviours"],
        OutcomeFiveC:["Explores and engages with numeracy in personally meaningful ways", "exploring number symbols and their purposes","confidence and interest in counting and exploring patterns and relationships","exploring mathematical thinking, concepts and language"]
    },

    PREP: {
        OutcomeOne: "Number and Place Value - Establish understanding of the language and processes of counting by naming numbers in sequences, initially to and from 20, moving from any starting point",
        OutcomeTwo: "Number and Place Value - Connect number names, numerals and quantities, including zero, initially up to 10 and then beyond.",
        OutcomeThree: "Number and Place Value - Subitise small collections of objects.",
        OutcomeFour: "Number and Place Value - Compare, order and make correspondences between collections, initially to 20, and explain reasoning.",
        OutcomeFive: "Number and Place Value - Represent practical situations to model addition and sharing."
    }


}

//data["EYLF"]["OutcomeOneA"].indexOf("")

function PrepData() {

    $.mobile.allowCrossDomainPages = true;

    loadingMessage("Preparing Data...");

    var tests = ["OutcomeOne", "OutcomeTwo", "OutcomeThree","OutcomeFour","OutcomeFive"]
    var outcomes = ReportOutcomes;

    SendData.outcomes = {};

    for(var i = 0; i<outcomes.length;i++) {
        outcomes[i] = outcomes[i].trim();
        for(var oc in data[ReportType]) {

            var index = data[ReportType][oc].indexOf(outcomes[i]);

            if(index != -1) {
                    var title = "";

                    for(var j = 0; j<tests.length; j++) {
                        var re = new RegExp(tests[j], 'g');
                        var match = oc.match(re)
                        if(match) {
                            title = data[ReportType][tests[j]];
                            j = tests.length;
                        }
                    }


                    if(SendData.outcomes[match[0]]) {
                            if(!SendData.outcomes[match[0]][oc]) { SendData.outcomes[match[0]][oc] = {}; }
                        SendData.outcomes[match[0]].Title = title;
                    }
                    else {
                        SendData.outcomes[match[0]] = {};
                        SendData.outcomes[match[0]][oc] = {};
                        SendData.outcomes[match[0]].Title = data[ReportType][match[0]];
                    }

                if(index == 0) {
                    SendData.outcomes[match[0]][oc].Descriptor = data[ReportType][oc][index];
                }
                else {
                    if(SendData.outcomes[match[0]][oc].Selections) {
                        SendData.outcomes[match[0]][oc].Selections.push(data[ReportType][oc][index])
                    }
                    else {
                        SendData.outcomes[match[0]][oc].Selections = [];
                        SendData.outcomes[match[0]][oc].Selections.push(data[ReportType][oc][index])
                    }
                }
            }
        }
    }


    if(window.Prototype) {
        delete Object.prototype.toJSON;
        delete Array.prototype.toJSON;
        delete Hash.prototype.toJSON;
        delete String.prototype.toJSON;
    }


    TryUploadImages();
}

function TryUploadImages() {

    if(SendData.imageData.length > 0) {

        uploadingPhoto();
        SendData.imageData.splice(0, 1);
        //var cImage = SendData.imageData.pop();
        //var cCaption = SendData.captionData.pop();
        var cImage = SendData.imageData.splice(0, 1);
        var cCaption = SendData.captionData.splice(0, 1);
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=cImage.substr(cImage.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        options.SendData = SendData;
        options.uuid = SendData.uuid;
        options.chunkedMode = false;

        var params = new Object();
        params.uuid = SendData.uuid;
		params.email = SendData.email;
		params.name = options.fileName;
        options.params = params;
        options.chunkedMode = false;
        options.timeout = 10000;

        var ft = new FileTransfer();
        ft.upload(cImage, "http://ec2-23-22-186-167.compute-1.amazonaws.com/school/upload",UploadImageSuccess, UploadImageFail, options);
    }
    else {
        uploadPhotoCB();
        TryUploadData();
    }
}


function TryUploadData() {

    loadingMessage("Uploading Report Data...");

    /* Fake Loads
    SendData.title = "Oh Hello";
    SendData.date = "09/04/11";
    SendData.images = 0;
    SendData.captions = [];
    SendData.notes = ['lol','lol','lol'];
    SendData.email = 'hello@gmail.com';
    SendData.cc = 'no@gmail.com';
    SendData.followupexperience = 'Stop itttttt';
    SendData.evaluation = 'TESDDDDD itttttt';
    SendData.type = 'EYLF';
    SendData.template = ReportTemplate;
    SendData.imageData = [];
    SendData.captionData = [];
    SendData.Background = SelectedBackground;
    SendData.Font = SelectedFont;
    SendData.FontColour = SelectedFontColour;
    SendData.principles = [1,1,1,1,1];
    SendData.practices = [2,2,2,2,2,2];
    */

    var emailObj = new Email(SendData.title, SendData.date, SendData.images, SendData.captions, SendData.notes, SendData.followupexperience, SendData.evaluation, SendData.type, SendData.Background, SendData.Font, SendData.template, SendData.outcomes, SendData.FontColour, SendData.principles, SendData.practices);
    var emailString = emailObj.GenerateEmail(SendData.template);
    if(SendData.cc == null) { SendData.cc = ""; }

    $.ajax({
        url: "http://ec2-23-22-186-167.compute-1.amazonaws.com/school/content",
        //url: "http://localhost:10080/school/content",
        timeout: 10000,
        type: "POST",
        data: JSON.stringify({uuid: SendData.uuid, cc:SendData.cc, to:SendData.email, body: emailString}),

        cache: false,
        success: function(response, status, obj){
            uploadPhotoCB();
            navigator.notification.alert(
                'Report Submitted',  // message
                function() {
                    if(ReportTerm == 0 || ReportTerm == "Other" || isTest == true ) {
                        isTest = false;
                    }
                    else {
                        CallbackData = 1;
                        UpdateStudentTermCB(CurrentStudent.name);
                    }
                },         // callback
                'Report Successfully Submitted',            // title
                'Close'                  // buttonName
            );

        },
        error: function(x,t,m) {
            uploadPhotoCB();

            if(t==="timeout") {
                navigator.notification.alert(
                    'Timed Out - The report failed to send to the server for emailing. Please ensure you have an active data connection and try again',  // message
                    function() {},         // callback
                    'Report Email Failed',            // title
                    'Close'                  // buttonName
                );
            } else {
                navigator.notification.alert(
                    'An error has occurred. Please ensure your data connection is still active and try again.',  // message
                    function() {},         // callback
                    'Report Email Failed',            // title
                    'Close'                  // buttonName
                );
            }

        }
    });
}

function UploadImageFail() {
    uploadPhotoCB();
    navigator.notification.alert(
        'Image could not be uploaded. Please ensure you have an active internet connection',  // message
        function() {},         // callback
        'Image Upload Failed',            // title
        'Close'                  // buttonName
    );
    //alert("Image could not be uploaded. Please ensure you have an active internet connection");
}

function UploadImageSuccess(r) {

    uploadPhotoCB();
    TryUploadImages();
}



function uploadingPhoto(){
    $.blockUI({ message: '<h4><img src="./img/busy.gif" /> Uploading Image...</h4>' });
}

function loadingMessage(msg) {
    $.blockUI({ message: '<h4><img src="./img/busy.gif" />'+ msg + '</h4>' });
}

function uploadPhotoCB(){
    $.unblockUI();
}



//var SendDataFormat = {

 //   Type: "EYLF",
 //   Title: "",
 //   Date: "",


//}